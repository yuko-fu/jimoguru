<p id="notice"><%= notice %></p>

<h1>お店検索</h1>

<table>
  <thead>
    <tr>
      <th>店名</th>
      <th>都道府県</th>
      <th>住所</th>
      <th>カテゴリー</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
  <input id="address" type="textbox" value="" placeholder="地名・地点を入力">
  <input type="button" value="検索" onclick="codeAddress()">
    <% @shops.each do |shop| %>
      <tr>
        <td><%= shop.name %></td>
        <td><%= shop.prefecture %></td>
        <td><%= shop.address %></td>
        <td><%= shop.latitude %></td>
        <td><%= shop.longitude %></td>
        <td><%= shop.category_id %></td>
        <td><%= link_to 'Show', shop %></td>
        <td><%= link_to 'Edit', edit_shop_path(shop) %></td>
        <td><%= link_to 'Destroy', shop, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>

    <div id='map'></div>
    <style>
      #map {
        height: 500px;
        width: 100%;
      }
    </style>
    <script>
      var map;
      var marker = [];
      var infoWindow = [];
      // コントローラーで定義したインスタンス変数(@shops)を代入
      var markerData = gon.shops;
          
      function initMapindex() {
        // マップの初期化
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 9,
          center: {lat: 35.4550426, lng: 139.6312741}
        }); 
      }
      for (var i = 0; i < markerData.length; i++) {
        let id = markerData[i]['id']

        // 各スポットの緯度経度を算出
        markerLatLng = new google.maps.LatLng({
          lat:  Number(markerData[i]['latitude']),
          lng:  Number(markerData[i]['longitude'])
        });

        // 各スポットのマーカーを作成
        marker[i] = new google.maps.Marker({
          position: markerLatLng,
          map: map
        });

        // 各スポットの吹き出しを作成
        infoWindow[i] = new google.maps.InfoWindow({
          // 吹き出しの内容
          content: `<a href='/flowers/${ id }' class='custom-link'>${ markerData[i]['name'] }<br><img src="${ markerData[i]['image_url'] }" width="100" /></a>`
        });

        // マーカーにクリックイベント追加
        markerEvent(i);
      }
    
    </script>  
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&libraries=places&callback=initMapindex" async defer></script>

  </tbody>
</table>

<br>

<%= link_to 'お店新規登録', new_shop_path %>
