<%= form_with(model: shop) do |form| %>
  <% if shop.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(shop.errors.count, "error") %> prohibited this shop from being saved:</h2>

      <ul>
        <% shop.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <div>
  <%= form_for :@shop, url: { action: :create }, method: :post do |f| %>
    <%= f.label :name %>
    <%= f.text_field :name, placeholder: "店名を入力してください" %>
    <br>
    <%= f.label :prefecture %>
    <%= f.text_field :prefecture, placeholder: "都道府県を入力してください" %>
    <br>
    <%= f.label :address %>
    <%= f.text_field :address, placeholder: "住所を入力してください" %>
    <br>
    <%= f.label :カテゴリー %>
    <%= f.collection_select :category_id, Category.all, :id, :name, { prompt: '選択してください' }, class: 'form-control' %>
    <br>
    <%= f.submit "登録" %>
    <% end %>
  </div>

  <div id="map" style="height: 400px; width: 100%;"></div>
  <script>
    // Your JavaScript code will go here
    var map;

    function initMap() {
      // 初期の地図の中心座標を設定
      var initialLatLng = { lat: 35.6895, lng: 139.6917 }; // 例: 東京の緯度経度

      // 地図を作成
      map = new google.maps.Map(document.getElementById('map'), {
        center: initialLatLng,
        zoom: 13 // ズームレベル（1-20の範囲で指定）
      });
    }

    // Geocoding APIを使用して住所から座標を取得し、地図上にマーカーを追加する関数
    function addMarker() {
      var geocoder = new google.maps.Geocoder();
      var address = document.getElementById('location_address').value;

      geocoder.geocode({ 'address': address }, function (results, status) {
        if (status === 'OK') {
          // 最初の結果を使用（通常、他にも複数の結果が返されることがあります）
          var location = results[0].geometry.location;
          // 地図上にマーカーを追加
          var marker = new google.maps.Marker({
            map: map,
            position: location
          });
          // マーカーをクリックしたときに情報ウィンドウを表示
          var infoWindow = new google.maps.InfoWindow({
            content: address
          });
          marker.addListener('click', function () {
            infoWindow.open(map, marker);
          });
        } else {
          alert('Geocode was not successful for the following reason: ' + status);
        }
      });
    }

    // ページがロードされたときに地図を初期化
    google.maps.event.addDomListener(window, 'load', initMap);
  </script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&libraries=places&callback=initMap" async defer></>
  

  <div class="field">
    <%= form.label :店名 %>
    <%= form.text_field :name %>
  </div>

  <div class="field">
    <%= form.label :都道府県 %>
    <%= form.text_field :prefecture, Ride.ride_areas.keys, {} %>
  </div>

  <div class="field">
    <%= form.label :住所 %>
    <%= form.text_field :address %>
  </div>

  <div class="field" hidden>
    <%= form.label :latitude %>
    <%= form.text_field :latitude %>
  </div>

  <div class="field" hidden>
    <%= form.label :longitude %>
    <%= form.text_field :longitude %>
  </div>

  <div class="field">
    <%= form.label :カテゴリー %>
    <%= form.collection_select :category_id, Category.all, :id, :name, { prompt: '選択してください' }, class: 'form-control' %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
